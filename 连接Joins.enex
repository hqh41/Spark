<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE en-export SYSTEM "http://xml.evernote.com/pub/evernote-export3.dtd">
<en-export export-date="20190730T115754Z" application="Evernote" version="Evernote Mac 6.13.1 (455786)">
<note><title>连接Joins</title><content><![CDATA[<!DOCTYPE en-note SYSTEM "http://xml.evernote.com/pub/enml2.dtd"><en-note><div><font face="Courier New">1.连接的类型:</font></div><div><font face="Courier New">(默认的)Inner joins(连接键在左右两表都同时存在)</font></div><div><font face="Courier New">Outer joins(连接键在左右两表之一存在)</font></div><div><font face="Courier New">Left outer joins(保留左边表的键)</font></div><div><font face="Courier New">Right outer joins(保留右边表的键)</font></div><div><font face="Courier New">Left semi joins(如果主键在右表中存在，则只打印左表的列)</font></div><div><font face="Courier New"><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">Left anti joins</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(如果主键在右表中</span><span style="font-size: 14px; color: rgb(0, 150, 255); font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">不</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">存在，则只打印对应的左表的列)</span></font></div><div><font face="Courier New">Natural joins(自动推断出类名和类型都相同的列，进行连接)</font></div><div><font face="Courier New">Cross join(两个表的笛卡尔乘积)</font></div><div><font face="Courier New"><br /></font></div><div><font style="font-size: 14px;" face="Courier New"><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">person </span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">= </span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">spark</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">.</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">createDataFrame</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> ([</span></font></div><div><font style="font-size: 14px;" face="Courier New"><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> , </span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">"Bill Chambers"</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> , </span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> , [</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">100</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">]),</span></font></div><div><font style="font-size: 14px;" face="Courier New"><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">1</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> , </span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">"Matei Zaharia"</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> , </span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">1</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> , [</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">500</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> , </span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">250</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> , </span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">100</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">]),</span></font></div><div><font style="font-size: 14px;" face="Courier New"><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">2</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> , </span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">"Michael Armbrust"</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> , </span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">1</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> , [</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">250</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> , </span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">100</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">])])\</span></font></div><div><font style="font-size: 14px;" face="Courier New"><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">.</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">toDF</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">"id"</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> , </span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">"name"</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> , </span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">"graduate_program"</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> , </span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">"</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal; color: rgb(133, 153, 0);">spark_status</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">"</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">)</span></font></div><div><font style="font-size: 14px;" face="Courier New"><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">graduateProgram </span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">= </span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">spark</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">.</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">createDataFrame</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">([</span></font></div><div><font style="font-size: 14px;" face="Courier New"><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">0</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> , </span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">"Masters"</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> , </span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">"School of Information"</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> , </span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">"UC Berkeley"</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">),</span></font></div><div><font style="font-size: 14px;" face="Courier New"><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">2</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> , </span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">"Masters"</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> , </span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">"EECS"</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> , </span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">"UC Berkeley"</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">),</span></font></div><div><font style="font-size: 14px;" face="Courier New"><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">1</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> , </span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">"Ph.D."</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> , </span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">"EECS"</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> , </span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">"UC Berkeley"</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">)])\</span></font></div><div><font style="font-size: 14px;" face="Courier New"><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">.</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">toDF</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">"id"</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> , </span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">"degree"</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> , </span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">"department"</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> , </span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">"school"</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">)</span></font></div><div><font style="font-size: 14px;" face="Courier New"><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">sparkStatus </span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">= </span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">spark</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">.</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">createDataFrame</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">([</span></font></div><div><font style="font-size: 14px;" face="Courier New"><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">500</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> , </span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">"Vice President"</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">),</span></font></div><div><font style="font-size: 14px;" face="Courier New"><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">250</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> , </span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">"PMC Member"</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">),</span></font></div><div><font style="font-size: 14px;" face="Courier New"><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">100</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> , </span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">"Contributor"</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">)])\</span></font></div><div><font face="Courier New"><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">.</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">toDF</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> (</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">"id"</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"> , "</span><span style="line-height: normal;">status"</span><span style="line-height: normal;">)</span></font></div><div><font face="Courier New"><br /></font></div><div><font style="font-size: 14px;" face="Courier New"><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">person</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">.</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">createOrReplaceTempView</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">"person"</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">)</span></font></div><div><font style="font-size: 14px;" face="Courier New"><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">graduateProgram</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">.</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">createOrReplaceTempView</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">"graduateProgram"</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">)</span></font></div><div><font face="Courier New"><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">sparkStatus</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">.</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">createOrReplaceTempView</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">"sparkStatus</span><span style="line-height: normal;"> »)</span></font></div><div><font face="Courier New"><br /></font></div><div><font style="font-size: 14px;" face="Courier New"><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal; color: rgb(255, 38, 0);">Inner Joins</span>:</span></font></div><div><font face="Courier New">&gt;&gt;&gt; <span style="color: rgb(0, 150, 255);">joinExpression = person["graduate_program"] == graduateProgram["id"]</span></font></div><div><font face="Courier New">&gt;&gt;&gt; wrongJoinExpression = person["name"] == graduateProgram["school"]</font></div><div><font face="Courier New">&gt;&gt;&gt; joinType = "inner"</font></div><div><font face="Courier New">&gt;&gt;&gt; <span style="color: rgb(0, 150, 255);">person</span>.join(<span style="color: rgb(0, 150, 255);">graduateProgram</span>, joinExpression, joinType).show()</font></div><div><font face="Courier New">+---+----------------+----------------+---------------+---+-------+--------------------+-----------+</font></div><div><font face="Courier New">| id|            name|graduate_program|   spark_status| id| degree|          department|     school|</font></div><div><font face="Courier New">+---+----------------+----------------+---------------+---+-------+--------------------+-----------+</font></div><div><font face="Courier New">|  0|   Bill Chambers|               0|          [100]|  0|Masters|School of Informa...|UC Berkeley|</font></div><div><font face="Courier New">|  1|   Matei Zaharia|               1|[500, 250, 100]|  1|  Ph.D.|                EECS|UC Berkeley|</font></div><div><font face="Courier New">|  2|Michael Armbrust|               1|     [250, 100]|  1|  Ph.D.|                EECS|UC Berkeley|</font></div><div><font face="Courier New">+---+----------------+----------------+---------------+---+-------+--------------------+-----------+</font></div><div><font face="Courier New"><br /></font></div><div><font style="font-size: 14px;" face="Courier New"><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal; color: rgb(255, 38, 0);">Outer Joins</span>:</span></font></div><div><font face="Courier New">&gt;&gt;&gt; joinType = "outer"</font></div><div><font face="Courier New">&gt;&gt;&gt; person.join(graduateProgram, joinExpression, joinType).show()</font></div><div><font face="Courier New"><br /></font></div><div><font face="Courier New">+----+----------------+----------------+---------------+---+-------+--------------------+-----------+</font></div><div><font face="Courier New">|  id|            name|graduate_program|   spark_status| id| degree|          department|     school|</font></div><div><font face="Courier New">+----+----------------+----------------+---------------+---+-------+--------------------+-----------+</font></div><div><font face="Courier New">|   0|   Bill Chambers|               0|          [100]|  0|Masters|School of Informa...|UC Berkeley|</font></div><div><font face="Courier New">|   1|   Matei Zaharia|               1|[500, 250, 100]|  1|  Ph.D.|                EECS|UC Berkeley|</font></div><div><font face="Courier New">|   2|Michael Armbrust|               1|     [250, 100]|  1|  Ph.D.|                EECS|UC Berkeley|</font></div><div><font face="Courier New">|null|            null|            null|           null|  2|Masters|                EECS|UC Berkeley|</font></div><div><font face="Courier New">+----+----------------+----------------+---------------+---+-------+--------------------+-----------+</font></div><div><font face="Courier New"><br /></font></div><div><font style="font-size: 14px;" face="Courier New"><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal; color: rgb(255, 38, 0);">Left Outer Joins</span>:</span></font></div><div><font face="Courier New">&gt;&gt;&gt; joinType = "left_outer"</font></div><div><font face="Courier New">&gt;&gt;&gt; graduateProgram.join(person, joinExpression, joinType).show()</font></div><div><font face="Courier New">+---+-------+--------------------+-----------+----+----------------+----------------+---------------+</font></div><div><font face="Courier New">| id| degree|          department|     school|  id|            name|graduate_program|   spark_status|</font></div><div><font face="Courier New">+---+-------+--------------------+-----------+----+----------------+----------------+---------------+</font></div><div><font face="Courier New">|  0|Masters|School of Informa...|UC Berkeley|   0|   Bill Chambers|               0|          [100]|</font></div><div><font face="Courier New">|  1|  Ph.D.|                EECS|UC Berkeley|   1|   Matei Zaharia|               1|[500, 250, 100]|</font></div><div><font face="Courier New">|  1|  Ph.D.|                EECS|UC Berkeley|   2|Michael Armbrust|               1|     [250, 100]|</font></div><div><font face="Courier New">|  2|Masters|                EECS|UC Berkeley|null|            null|            null|           null|</font></div><div><font face="Courier New">+---+-------+--------------------+-----------+----+----------------+----------------+---------------+</font></div><div><font face="Courier New"><br /></font></div><div><font face="Courier New"><span style="color: rgb(255, 38, 0);">Right Outer Joins</span>:</font></div><div><font face="Courier New">&gt;&gt;&gt; joinType = "right_outer"</font></div><div><font face="Courier New">&gt;&gt;&gt; person.join(graduateProgram, joinExpression, joinType).show()</font></div><div><font face="Courier New">+----+----------------+----------------+---------------+---+-------+--------------------+-----------+</font></div><div><font face="Courier New">|  id|            name|graduate_program|   spark_status| id| degree|          department|     school|</font></div><div><font face="Courier New">+----+----------------+----------------+---------------+---+-------+--------------------+-----------+</font></div><div><font face="Courier New">|   0|   Bill Chambers|               0|          [100]|  0|Masters|School of Informa...|UC Berkeley|</font></div><div><font face="Courier New">|   1|   Matei Zaharia|               1|[500, 250, 100]|  1|  Ph.D.|                EECS|UC Berkeley|</font></div><div><font face="Courier New">|   2|Michael Armbrust|               1|     [250, 100]|  1|  Ph.D.|                EECS|UC Berkeley|</font></div><div><font face="Courier New">|null|            null|            null|           null|  2|Masters|                EECS|UC Berkeley|</font></div><div><font face="Courier New">+----+----------------+----------------+---------------+---+-------+--------------------+-----------+</font></div><div><font face="Courier New"><br /></font></div><div><font style="font-size: 14px;" face="Courier New"><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">Left Semi Joins:</span></font></div><div><font face="Courier New">&gt;&gt;&gt; joinType = "left_semi"</font></div><div><font face="Courier New">&gt;&gt;&gt; graduateProgram.join(person, joinExpression, joinType).show()</font></div><div><font face="Courier New">+---+-------+--------------------+-----------+</font></div><div><font face="Courier New">| id| degree|          department|     school|</font></div><div><font face="Courier New">+---+-------+--------------------+-----------+</font></div><div><font face="Courier New">|  0|Masters|School of Informa...|UC Berkeley|</font></div><div><font face="Courier New">|  1|  Ph.D.|                EECS|UC Berkeley|</font></div><div><font face="Courier New">+---+-------+--------------------+-----------+</font></div><div><font face="Courier New"><br /></font></div><div><font face="Courier New"><span style="color: rgb(255, 38, 0);">Left Anti Joins</span>:</font></div><div><font face="Courier New">&gt;&gt;&gt; joinType = "left_anti"</font></div><div><font face="Courier New">&gt;&gt;&gt; graduateProgram.join(person, joinExpression, joinType).show()</font></div><div><font face="Courier New">+---+-------+----------+-----------+</font></div><div><font face="Courier New">| id| degree|department|     school|</font></div><div><font face="Courier New">+---+-------+----------+-----------+</font></div><div><font face="Courier New">|  2|Masters|      EECS|UC Berkeley|</font></div><div><font face="Courier New">+---+-------+----------+-----------+</font></div><div><font face="Courier New"><br /></font></div><div><font style="font-size: 14px;" face="Courier New" color="#0096ff"><span style="font-size: 14px; color: rgb(0, 150, 255); font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">Natural join 和 Cross join非常危险，基本不用</span></font></div><div><font style="font-size: 14px;" face="Courier New"><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;"><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal; color: rgb(255, 38, 0);">Cross Joins</span>:</span></font></div><div><font face="Courier New">&gt;&gt;&gt; joinType = "cross"</font></div><div><font face="Courier New">&gt;&gt;&gt; graduateProgram.join(person, joinExpression, joinType).show()</font></div><div><font face="Courier New">+---+-------+--------------------+-----------+---+----------------+----------------+---------------+</font></div><div><font face="Courier New">| id| degree|          department|     school| id|            name|graduate_program|   spark_status|</font></div><div><font face="Courier New">+---+-------+--------------------+-----------+---+----------------+----------------+---------------+</font></div><div><font face="Courier New">|  0|Masters|School of Informa...|UC Berkeley|  0|   Bill Chambers|               0|          [100]|</font></div><div><font face="Courier New">|  1|  Ph.D.|                EECS|UC Berkeley|  1|   Matei Zaharia|               1|[500, 250, 100]|</font></div><div><font face="Courier New">|  1|  Ph.D.|                EECS|UC Berkeley|  2|Michael Armbrust|               1|     [250, 100]|</font></div><div><font face="Courier New">+---+-------+--------------------+-----------+---+----------------+----------------+---------------+</font></div><div><font face="Courier New"><br /></font></div><div><font face="Courier New"><span style="color: rgb(255, 38, 0);">在复杂类型上做连接</span>:</font></div><div><font face="Courier New">&gt;&gt;&gt; from pyspark.sql.functions import expr</font></div><div><font face="Courier New">&gt;&gt;&gt; person.withColumnRenamed("id", "personId")\</font></div><div><font face="Courier New">... .join(sparkStatus, <span style="color: rgb(0, 150, 255);">expr("array_contains(</span><span style="color: rgb(133, 153, 0);">spark_status</span><span style="color: rgb(0, 150, 255);">, id)"))</span>.show()</font></div><div><font face="Courier New">+--------+----------------+----------------+---------------+---+--------------+</font></div><div><font face="Courier New">|personId|            name|graduate_program|   spark_status| id|        status|</font></div><div><font face="Courier New">+--------+----------------+----------------+---------------+---+--------------+</font></div><div><font face="Courier New">|       0|   Bill Chambers|               0|          [100]|100|   Contributor|</font></div><div><font face="Courier New">|       1|   Matei Zaharia|               1|[500, 250, 100]|500|Vice President|</font></div><div><font face="Courier New">|       1|   Matei Zaharia|               1|[500, 250, 100]|250|    PMC Member|</font></div><div><font face="Courier New">|       1|   Matei Zaharia|               1|[500, 250, 100]|100|   Contributor|</font></div><div><font face="Courier New">|       2|Michael Armbrust|               1|     [250, 100]|250|    PMC Member|</font></div><div><font face="Courier New">|       2|Michael Armbrust|               1|     [250, 100]|100|   Contributor|</font></div><div><font face="Courier New">+--------+----------------+----------------+---------------+---+--------------+</font></div><div><font face="Courier New"><br /></font></div><div><font face="Courier New"><span style="color: rgb(255, 38, 0);">处理重复列名</span>:</font></div><div><font face="Courier New"><span style="font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal; font-size: 14px;">In a DataFrame, each column has a unique ID within Spark’s SQL Engine, </span><span style="font-size: 14px;">Catalyst.</span></font></div><div><span style="font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal; font-size: 14px;"><font face="Courier New">This unique ID is purely internal and not something that you can directly reference.</font></span></div><div><font style="font-size: 14px;" face="Courier New"><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">This makes it quite difficult to refer to a specific column when you have a DataFrame with </span><span style="font-size: 14px;">duplicate column names.</span></font></div><div><font face="Courier New"><br /></font></div><div><font face="Courier New">让我们来创建两个“问题”列表:</font></div><div><font face="Courier New">&gt;&gt;&gt; joinExpr = gradProgramDupe["graduate_program"]\</font></div><div><font face="Courier New">== person["graduate_program"]</font></div><div><font face="Courier New">&gt;&gt;&gt; person.join(gradProgramDupe, joinExpr)\</font></div><div><font face="Courier New">.select(col("graduate_program")).show()</font></div><div><font face="Courier New">//<span style="color: rgb(255, 138, 216);">发现出错</span>:</font></div><div><font face="Courier New">Traceback (most recent call last):</font></div><div><font face="Courier New">  File "&lt;stdin&gt;", line 2, in &lt;module&gt;</font></div><div><font face="Courier New">  File "/spark/python/pyspark/sql/dataframe.py", line 1202, in select</font></div><div><font face="Courier New">    jdf = self._jdf.select(self._jcols(*cols))</font></div><div><font face="Courier New">  File "/spark/python/lib/py4j-0.10.6-src.zip/py4j/java_gateway.py", line 1160, in __call__</font></div><div><font face="Courier New">  File "/spark/python/pyspark/sql/utils.py", line 69, in deco</font></div><div><font face="Courier New">    raise AnalysisException(s.split(': ', 1)[1], stackTrace)</font></div><div><font face="Courier New">pyspark.sql.utils.AnalysisException: u"Reference 'graduate_program' is <span style="color: rgb(255, 38, 0);">ambiguous</span>, could be: graduate_program, graduate_program.;"</font></div><div><font face="Courier New">//<span style="color: rgb(255, 138, 216);">解决办法</span>:</font></div><div><font face="Courier New">1.Different join expression</font></div><div><font style="font-size: 14px;" face="Courier New"><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">person</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">.</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">join</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">gradProgramDupe</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">,</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">"graduate_program"</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">).</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">select</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">(</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">"graduate_program"</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">).</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">show</span><span style="font-size: 14px; font-style: normal; font-variant-caps: normal; font-weight: normal; line-height: normal;">()</span></font></div><div><font face="Courier New">+----------------+</font></div><div><font face="Courier New">|graduate_program|</font></div><div><font face="Courier New">+----------------+</font></div><div><font face="Courier New">|               0|</font></div><div><font face="Courier New">|               1|</font></div><div><font face="Courier New">|               1|</font></div><div><font face="Courier New">+----------------+</font></div><div><font face="Courier New"><br /></font></div><div><font face="Courier New">2.Dropping the column after the join</font></div><div><font face="Courier New">&gt;&gt;&gt; person.join(gradProgramDupe, joinExpr)\</font></div><div><font face="Courier New">... .drop(person["graduate_program"])\</font></div><div><font face="Courier New">... .select(col("graduate_program")).show()</font></div><div><font face="Courier New">+----------------+</font></div><div><font face="Courier New">|graduate_program|</font></div><div><font face="Courier New">+----------------+</font></div><div><font face="Courier New">|               0|</font></div><div><font face="Courier New">|               1|</font></div><div><font face="Courier New">|               1|</font></div><div><font face="Courier New">+----------------+</font></div><div><font face="Courier New"><br /></font></div><div><font face="Courier New">3.Renaming a column before the join</font></div><div><font face="Courier New">&gt;&gt;&gt; gradProgram3 = graduateProgram.withColumnRenamed("id", "grad_id")</font></div><div><font face="Courier New">&gt;&gt;&gt; joinExpr = person["graduate_program"] == \</font></div><div><font face="Courier New">... gradProgram3["grad_id"]</font></div><div><font face="Courier New">&gt;&gt;&gt; person.join(gradProgram3, joinExpr).show()</font></div><div><font face="Courier New">+---+----------------+----------------+---------------+-------+-------+--------------------+-----------+</font></div><div><font face="Courier New">| id|            name|graduate_program|   spark_status|grad_id| degree|          department|     school|</font></div><div><font face="Courier New">+---+----------------+----------------+---------------+-------+-------+--------------------+-----------+</font></div><div><font face="Courier New">|  0|   Bill Chambers|               0|          [100]|      0|Masters|School of Informa...|UC Berkeley|</font></div><div><font face="Courier New">|  1|   Matei Zaharia|               1|[500, 250, 100]|      1|  Ph.D.|                EECS|UC Berkeley|</font></div><div><font face="Courier New">|  2|Michael Armbrust|               1|     [250, 100]|      1|  Ph.D.|                EECS|UC Berkeley|</font></div><div><font face="Courier New">+---+----------------+----------------+---------------+-------+-------+--------------------+-----------+</font></div><div><font face="Courier New"><br /></font></div><div><font face="Courier New"><br /></font></div><div><font face="Courier New"><br /></font></div><div><font face="Courier New"><br /></font></div><div><font face="Courier New"><br /></font></div><div><br /></div></en-note>]]></content><created>20190730T022701Z</created><updated>20190730T115556Z</updated><note-attributes><latitude>34.21928573651479</latitude><longitude>108.8893111671191</longitude><altitude>410.7215576171875</altitude><author>hqh41@outlook.com</author><source>desktop.mac</source><reminder-order>0</reminder-order></note-attributes></note>
</en-export>
